# Datalogger programming introduction

 <title>Datalogger programming introduction
</title>
<p>Overview articles give background information and provide context to a particular subject.
Their goal is to explain a concept, not to teach or give instructions.</p>
<chapter title="Campbell scientific documentation and videos" id="campbell-scientific-documentation-and-videos">
<p>There is a wealth of online documentation and videos available from Campbell Scientific to help your program their dataloggers.</p>
<p>A YouTube channel is available <a href="https://www.youtube.com/@CampbellScientific/videos">here</a>.</p>
<p>A web version of the CRBasic documentation is available <a href="https://help.campbellsci.com/crbasic/cr1000x/">here</a>. This includes example
programs for each of the built-in CRBasic functions and should be your go-to reference when writing a program.</p>
<p>CR1000X getting started tutorial <a href="https://www.campbellsci.eu/videos/cr1000x-getting-started-tutorial">here</a></p>
</chapter>
<chapter title="How to write a program for the CR1000X data logger" id="how-to-write-a-program-for-the-cr1000x-data-logger">
<p>There are two ways to write a logger program:</p>
<list type="decimal">
<li>Use the 'Short Cut' application wizard to select the sensors you want to use, the measurement values and time intervals to automatically generate a logger program and wiring diagram. This works fine for simple programs where the sensor you want to use is one of those that Short Cut supports in its list of sensors. Using this method can also be useful as a starting point for a program that you will eventually customise by hand as it can produce a file that CRBasic Editor can use (click on the advanced tab when you've finished and saved your program, and you can click on the button to open it up in the CRBasic editor application):
<img src="ShortCut-advanced.png" width="750" title="ShortCut advanced mode" alt="Shortcut advanced mode"/></li>
<li>The other way is to use the CRBasic editor that allows you to write a program from scratch. This will be necessary for a sensor that is not supported by Short Cut and is the tool should ultimately be aiming to use. CRBasic editor had built-in help files for program functions and can check and compile your code before sending it to a connected logger.</li>
</list>
</chapter>
<chapter title="Using the 'ShortCut' application to generate a program for you" id="using-the-shortcut-application-to-generate-a-program-for-you">
<p>Open up the Short Cut application, click 'Create new program' and follow the steps through the 'wizard', selecting you logger type, the sensors and parameters you want to measure. The application will also show you how to wire the sensor. You must follow this wiring otherwise the sensor will not work with the code generated by Short Cut. A Short Cut tutorial can be found <a href="https://www.campbellsci.eu/videos/programming-with-short-cut-quickstart-part-2">here</a>.</p>
</chapter>
<chapter title="How a CR1000X organises and stores data - 'Tables'" id="how-a-cr1000x-organises-and-stores-data-tables">
<p>This is an important concept to grasp when starting out on your datalogger programming journey. Within CRBasic programs, data storage is typically achieved through the use of table structures. These tables are essentially organized arrays where data collected from sensors or calculated values are stored.</p>
<p>A <a anchor="glossary">data table</a> is essentially a file that resides in data logger memory. The file consists of five or more rows. Each row consists of columns, or fields. The first four rows constitute the file header. Subsequent rows contain data records. Data tables may store individual measurements, individual calculated values, or summary data such as averages, maximums, or minimums.</p>
<p>Typically, files are written to based on time or event. The number of data tables is limited to 250, which includes the Public, Status, DataTableInfo, and ConstTable. You can retrieve data based on a schedule or by manually choosing to collect data using data logger support software.</p>
<p>Defining variables and data tables appropriately in the CRBasic program helps simplify accessing and processing the stored data values later.</p>
<img src="datatable_example.svg" alt="Datatable example" title="Datatable example" />
</chapter>
<chapter title="Constants, variables and alias" id="constants-variables-and-alias">
<p>A <emphasis>constant</emphasis> is value declared at the beginning of a program. It is a value that does not change during the
program execution. For example:</p>
<p><code>CONST PI = 3.141592654     'Define constant.</code></p>
<p>A <emphasis>variable</emphasis> is a value declared at the beginning of a program and can be changed during the program execution. Variables declared using the <control>Public</control> instruction are available for viewing on the datalogger's display and within software such as Loggernet. Variables declared using the <control>Dim</control> instruction are not available for viewing. &quot;Scratch&quot; variables and variables that are not important for the user to monitor are often defined with the <control>Dim</control> instruction. For example:</p>

<code-block>
'Public Variables
Public count As Long        'create a Long variable
Public Number = 38.3        'create a Float variable and set to 38.3
Public PubString As String  'create a string variable
</code-block>

<code-block>
'Dim (private) variables
Dim DimArray3D(2, 3, 4) 'create a 3-dimensional array with 24 elements
Dim DimArray1D(9) 'create a 1-dimensional array with 9 elements
Dim DimString As String * 50 'create a string variable - 50 characters
</code-block>
<p>An <emphasis>alias</emphasis> declaration is used to assign a second name to a Dim or Public variable. This can be useful if you
want to use a variable name that is more meaningful to you. Here's an example of the use of alias's:</p>
<p>The example shows how to use the Alias declaration. TCTemp is the original variable array. CoolantT, ManifoldT, and ExhaustT are the aliases that are assigned to these variables:</p>

<code-block>
Public TCTemp( 3 ), Ptemp
Alias TCTemp( 1 ) = CoolantT
Alias TCTemp( 2 ) = ManifoldT
Alias TCTemp( 3 ) = ExhaustT
</code-block>
</chapter>
<chapter title="Scans and Slow Scans" id="scans-and-slow-scans">
<p>A <control>scan</control> is a series of measurements made at a particular time interval. A <control>slowscan</control> is a series of measurements made at
a slower time interval. For example, you might wish to read a number of analogue sensors at a 1-second interval that would be your <emphasis>main</emphasis> scan and
then read a number of digital sensors at a 10-second interval that would be your <emphasis>slow</emphasis> scan.</p>

<code-block>
BeginProg
Scan( 1, sec, 1, 0 )      'Continuous Scan/Next Scan Loop
  '(measurement instructions, calls to data tables, etc.)
NextScan
EndProg
</code-block>
</chapter>
<chapter title="Functions and subroutines" id="functions-and-subroutines">
<p>A function is a block of code that can be used to perform a specific task. Functions are useful when you want to perform a specific task multiple times in your program.
A subroutine is also a block of code that can be used to perform a specific task. A Subroutine (Sub) is a separate procedure that is called by the main program using a Call statement. A Subroutine can take arguments, perform a series of statements, and change the value of its arguments. One difference between a Sub and a Function is a Function returns a value whereas a subroutine does not. Functions also include the ability to pass in optional parameters.</p>
<p>'Subroutine <control>(Sub)</control> to convert temperature in degrees C to degrees F</p>

<code-block>
Sub ConvertCtoF (Tmp, TmpF)
  TmpF = Tmp*1.8 +32
EndSub
</code-block>
<p>An example of a function - This example creates a function that issues a 2-second toggle to a control port whenever a flag is high and returns the string &quot;BlinkBlink&quot;:</p>

<code-block>
Public Flag(2), BlinkStatus As String
Function Blink As String
  PortSet (C1,1 )
  Delay (0,2,Sec)
  PortSet (C1,0 )
  Return (&quot;BlinkBlink&quot;)
EndFunction
BeginProg
Scan (1,Sec,3,0)
If Flag(1) Then
BlinkStatus=Blink()
Else
BlinkStatus=&quot;off&quot;
EndIf
NextScan
EndProg
</code-block>
</chapter>
<chapter title="Program comments" id="program-comments">
<p>Program comments are used to describe the purpose of a program. Comments can be used to explain the purpose of
a program, to explain the purpose of a section of code, or to explain the purpose of a variable. In the CRBasic programming language
comments preceded by a single quote ('). Comments can be placed anywhere in a program and are ignored by the compiler.</p>
</chapter>
<chapter title="The basic structure of a CRBasic logger program" id="the-basic-structure-of-a-crbasic-logger-program">
<p>All CRBasic logger programs follow the same structure no matter how complicated or simple they are:</p>
<list type="decimal">
<li>Define variables, constants, aliases (if used) and units (if used).</li>
<li>Define the tables that will store your data using the 'DataTable' function (this will include how often data is stored and whether it is maximum/minimum/sample etc. over the storage interval period).</li>
<li>Write any functions and subroutines that you want to use within your program.</li>
<li>The 'BeginProg' statement that marks the start of the program.</li>
<li>Configuration and setup of your program instructions e.g. opening up serial ports.</li>
<li>A 'Scan' function that is you primary scan loop e.g. scanning certain sensors every second.</li>
<li>'CallTable' statements to update the data tables you've defined.</li>
<li>Optionally 'SlowSequence' functions that are used to scan sensors at a slower rate than the main scan loop.</li>
<li>The 'EndProg' statement to signify the end of the program (though the program will continue with its Scan sequences, so this really refers to the end of the program scans setup).</li>
</list>
<p>This structure is shown in the diagram below:</p>
<img src="CRBasic_prog_struct.svg" width="1200" title="CRBasic logger program structure" alt="CRBasic logger program structure"/>
</chapter>
<chapter title="SurfaceNet CRBasic logger program structure" id="surfacenet-crbasic-logger-program-structure">
<p>For interest, here is the structure of the SurfaceNet logger program. This a very large and complex data logger program, but you can see that still follows the basic structure of all CRBasic logger programs:</p>
<img src="CR1000x-SfcNet-prog-diag.svg" title="SurfaceNet CRBasic program structure" width="750" alt="SurfaceNet CRBasic program structure"/>
</chapter>
<chapter title="Compiling your program and sending it to the logger" id="compiling-your-program-and-sending-it-to-the-logger">
<p>Once you've written your program, you need to compile it. Compiling a program is the process of converting the
program text file into instructions that the datalogger can understand. If you use the 'Short Cut' application to generate your program then
it will compile your program before it sends it to a datalogger. The CRBasic Editor application can check your code and compile it before sending it
to one of the dataloggers you have set up in LoggerNet or PC400. CRBasic Editor gives you control over whether you want save, compile and send or
just compile your program. See the screenshot below:</p>
<img src="CRBasic_compile.png" width="850" title="CRBasic compile menu" alt="CRBasic compile menu"/>
</chapter>
<chapter title="Debugging your program" id="debugging-your-program">
<p>When you compile your program in CRBasic it will check your program for errors and give you a list of errors at the bottom of the CRBasic application
window. These could be a typo in your program, an incorrect number of parameters in a function or subroutine. The error description should provide
enough details and a program line number to enable to correct the error. In addition to errors that prevent your program from compiling, 'warnings' will also be shown in the same area. A warning could be that you declared a variable that is not used in your program. Warnings will not a program from being compiled, they are provided for information. See an example of the CRBasic compile information below (DataTable has been spelled incorrectly resulting in several error messages):</p>
<img src="CRBasic-errors.png" width="750" title="CRBasic error messages" alt="CRBasic error messages"/>
</chapter>
<chapter title="Quick Quiz" id="quick-quiz">
</chapter>
<chapter title="Glossary" id="glossary">
<p>Programming terminology:</p>
<deflist>
<def>
<title>Variables</title><p>In computer programming, variables are essentially containers for storing data values. They serve as placeholders for values that may change during the execution of a program. Variables have a name, a data type, and a value.
Here's a breakdown of these components:</p>
<list>
<li><control>Name:</control> Also known as an identifier, it is a meaningful name given to the variable by the programmer. It is used to uniquely identify the variable within the program.</li>
<li><control>Data Type:</control> Defines the type of data that the variable can hold, such as integers, floating-point numbers, characters, strings, etc. The data type determines the operations that can be performed on the variable and the amount of memory it occupies.</li>
<li><control>Value:</control> The actual data stored in the variable. This value can be changed or modified during the execution of the program.</li>
</list>
</def>
<def>
<title>Constants</title><p>In computer programming, a constant is a value that remains unchanged throughout the execution of a program. Constants are typically used to represent fixed values that are known at compile time and are not meant to be modified during runtime. They are helpful for making code more readable, maintainable, and less error-prone by providing meaningful names for values that are used repeatedly throughout the codebase.
Constants can be of various data types, including integers, floating-point numbers, characters, strings, and Boolean values. In many programming languages, constants are declared using specific syntax or keywords, such as &quot;const&quot; or &quot;final&quot;.</p>
</def>
<def>
<title>Functions</title><p>In computer programming, a function is a block of reusable code that performs a specific task. Functions allow programmers to break down a program into smaller, manageable pieces, making the code more organized, readable, and easier to maintain. Functions typically accept inputs, process them, and then return a result. They help in modularizing code, promoting code re-usability, and improving overall program structure.</p>
</def>
<def>
<title>Tables</title><p>A data table is a key component in CRBasic programming for Campbell Scientific dataloggers. It is used to store the measured data from sensors and other inputs. The data table must be called by the CRBasic program for the data processing and storage to occur.</p>
</def>
<def>
<title>Scans</title><p>In the context of CRBasic programming for Campbell Scientific data loggers, a scan refers to the fundamental unit of program execution. Specifically,
the Scan instruction is used to establish the program scan rate, which determines how often the program will execute.</p>
</def>
<def>
<title>Compiler</title><p>A compiler is a computer program that translates source code written in a high-level programming language into machine code or lower-level code that can be directly executed by a computer's CPU (Central Processing Unit). The process involves several stages, including scanning analysis, syntax analysis, semantic analysis, optimization, and code generation.</p>
</def>
<def>
<title>Debugging</title><p>Debugging, in the context of computer programming, refers to the process of identifying, analyzing, and fixing errors, defects, or bugs within a software application or system. These bugs can cause the program to behave unexpectedly, produce incorrect results, or even crash.</p>
</def>
<def>
<title>Comments</title><p>In computer programming, comments are non-executable portions of code used to annotate or explain the functionality, purpose, or rationale behind specific sections of code. Comments are primarily intended for human readers rather than the computer itself and are typically ignored by the compiler or interpreter during the execution of the program.</p>
</def>
</deflist>


</chapter>